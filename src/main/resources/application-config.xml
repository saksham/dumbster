<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">

    <context:annotation-config/>
    <context:component-scan base-package="com.dumbster.smtp.app, com.dumbster.smtp.storage, com.dumbster.smtp.transport"
                            use-default-filters="false"/>

    <bean name="mailProcessor,com.dumbster.smtp.app.MailProcessor" class="com.dumbster.smtp.app.MailProcessor"
          lazy-init="false">
        <property name="mailMessageDao" ref="com.dumbster.smtp.storage.MailMessageDao"/>
        <property name="emailSender" ref="com.dumbster.smtp.utils.EmailSender"/>
        <property name="relayAddressDao" ref="com.dumbster.smtp.storage.RelayAddressDao"/>
    </bean>

    <bean name="com.dumbster.smtp.transport.SmtpServer" class="com.dumbster.smtp.transport.SmtpServer">
        <constructor-arg name="port" value="2500"/>
    </bean>

    <bean name="com.dumbster.smtp.transport.ApiServer" class="com.dumbster.smtp.transport.ApiServer">
        <constructor-arg name="port" value="6869"/>
        <property name="apiServerInitializer" ref="com.dumbster.smtp.transport.ApiServerInitializer"/>
    </bean>

    <bean name="com.dumbster.smtp.storage.MailMessageDaoFactory"
          class="com.dumbster.smtp.storage.MailMessageDaoFactory"
          factory-method="getInstance"/>

    <bean name="com.dumbster.smtp.storage.MailMessageDao"
          factory-bean="com.dumbster.smtp.storage.MailMessageDaoFactory" factory-method="getDao"/>

    <bean name="com.dumbster.smtp.storage.RelayAddressDaoFactory,relayAddressDaoFactory"
          class="com.dumbster.smtp.storage.RelayAddressDaoFactory"
          factory-method="getInstance"/>

    <bean name="com.dumbster.smtp.storage.RelayAddressDao,relayAddressDao"
          factory-bean="com.dumbster.smtp.storage.RelayAddressDaoFactory" factory-method="getDao"/>

    <bean name="com.dumbster.smtp.utils.EmailSender" class="com.dumbster.smtp.utils.EmailSender">
        <constructor-arg name="smtpHostname" value="smtp.gmail.com"/>
        <constructor-arg name="smtpPort" value="567"/>
    </bean>

    <bean name="com.dumbster.smtp.transport.ApiServerInitializer"
          class="com.dumbster.smtp.transport.ApiServerInitializer">
        <property name="apiServerHandler" ref="com.dumbster.smtp.transport.ApiServerHandler"/>
    </bean>

    <bean name="com.dumbster.smtp.transport.ApiServerHandler"
          class="com.dumbster.smtp.transport.ApiServerHandler" scope="prototype">
        <property name="relayAddressDao" ref="com.dumbster.smtp.storage.RelayAddressDao"/>
        <property name="mailMessageDao" ref="com.dumbster.smtp.storage.MailMessageDao"/>
        <property name="mailProcessor" ref="com.dumbster.smtp.app.MailProcessor"/>
        <property name="smtpServer" ref="com.dumbster.smtp.transport.SmtpServer"/>
    </bean>
</beans>